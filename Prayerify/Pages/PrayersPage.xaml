<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
			 xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
			 x:Class="Prayerify.Pages.PrayersPage"
			 Title="Prayers">
	<ContentPage.ToolbarItems>
        <ToolbarItem Text="Add" Command="{Binding AddPrayerCommand}"/>
        <ToolbarItem Text="Search" Command="{Binding ToggleSearchVisibilityCommand}"/>
    </ContentPage.ToolbarItems>
	<Grid RowDefinitions="Auto,*">
		<!-- Search and Filter Section -->
		<StackLayout Grid.Row="0" 
					 IsVisible="{Binding IsSearchVisible}"
					 BackgroundColor="{AppThemeBinding Light=#CEBEBE, Dark=Transparent}"
					 Padding="16,8"
					 Spacing="8">
			
			<!-- Search Bar -->
			<Grid ColumnDefinitions="*,Auto">
				<SearchBar Grid.Column="0"
						   Text="{Binding SearchText}"
						   Placeholder="Search prayers..."
						   BackgroundColor="White"
						   CancelButtonColor="Gray"
                           MaxLength="30" />
				<Button Grid.Column="1"
						Text="Clear"
						Command="{Binding ClearSearchCommand}"
						BackgroundColor="Transparent"
						TextColor="{AppThemeBinding Light=Black, Dark=White}"
						FontSize="15"
						Padding="12,0"/>
			</Grid>
			
			<!-- Category Filter -->
			<Grid ColumnDefinitions="Auto,*,Auto">
				<Label Grid.Column="0"
					   Text="Category:"
					   VerticalOptions="Center"
					   FontSize="14"
					   TextColor="Black"
                       Margin="0,0,8,0"/>
				<Picker Grid.Column="1"
						ItemsSource="{Binding Categories}"
						SelectedItem="{Binding SelectedCategory}"
						ItemDisplayBinding="{Binding Name}"
						Title="All Categories"
						BackgroundColor="White"/>
				<Button Grid.Column="2"
						Text="Clear"
						Command="{Binding ClearFiltersCommand}"
						BackgroundColor="Transparent"
						TextColor="{AppThemeBinding Light=Black, Dark=White}"
						FontSize="15"
						Padding="12,0"/>
			</Grid>
		</StackLayout>
		
		<!-- Prayers Collection -->
        <!--<Label Text="No prayers found. Try adjusting your search or filters." 
               IsVisible="{Binding AnyPrayerCreated}" 
               Grid.Row="1"
               VerticalOptions="Center"
               HorizontalOptions="Center" />-->
        <CollectionView Grid.Row="1"
						ItemsSource="{Binding Prayers}"
						Margin="16">
		<CollectionView.ItemTemplate>
			<DataTemplate>
				<SwipeView>
					<SwipeView.RightItems>
						<SwipeItems Mode="Reveal">
							<SwipeItem Text="Answered"
									  BackgroundColor="DarkGreen"
									  Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ToggleAnsweredCommand}"
									  CommandParameter="{Binding .}" />
							<SwipeItem Text="Delete"
									  BackgroundColor="DarkRed"
									  Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeletePrayerCommand}"
									  CommandParameter="{Binding .}" />
                            <SwipeItem Text="Edit"
								  BackgroundColor="#6D2E46"
								  Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.EditPrayerCommand}"
								  CommandParameter="{Binding .}" />
                            </SwipeItems>
					</SwipeView.RightItems>
					<Frame Padding="12" Margin="0,8" CornerRadius="12" HasShadow="False">
                        <Grid ColumnDefinitions="*" RowDefinitions="Auto,Auto,Auto,Auto">
                            <Label Text="{Binding PrayerTitle}" FontAttributes="Bold" FontSize="25"/>
							<Label Text="{Binding PrayerDescription}" Grid.Row="1" Opacity="0.8" Margin="0,8,0,0" FontSize="20"/>
                            <Label Text="{Binding CategoryName}" Grid.Row="2" Opacity="0.6" Margin="0,8,0,0" FontSize="14"/>
                            <Label Text="{Binding CreatedUtc}" Grid.Row="2" Opacity="0.8" Margin="0,8,0,0" TextColor="Grey" HorizontalTextAlignment="End" FontSize="14"/>
                        </Grid>
					</Frame>
				</SwipeView>
			</DataTemplate>
		</CollectionView.ItemTemplate>
		</CollectionView>
	</Grid>
</ContentPage>


